# ==========================================
# API GATEWAY CONFIGURATION (From Config Server)
# ==========================================
# Common configs (Eureka, Logging patterns, Circuit Breaker defaults, etc.) 
# are inherited from application.properties
# Only gateway-specific configurations here

server.port=9080
spring.application.name=api-gateway

# ==========================================
# GATEWAY-SPECIFIC EUREKA METADATA
# ==========================================
eureka.instance.metadata-map.service-type=gateway
eureka.instance.health-check-url-path=/actuator/health

# ==========================================
# SPRING CLOUD GATEWAY CONFIGURATION
# ==========================================
spring.cloud.gateway.enabled=true

# Global timeout settings
spring.cloud.gateway.httpclient.connect-timeout=3000
spring.cloud.gateway.httpclient.response-timeout=5s

# Connection pool settings
spring.cloud.gateway.httpclient.pool.type=ELASTIC
spring.cloud.gateway.httpclient.pool.max-connections=500
spring.cloud.gateway.httpclient.pool.acquire-timeout=45000

# Discovery locator
spring.cloud.gateway.discovery.locator.enabled=false
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ==========================================
# AUTHENTICATION SERVICE CONFIGURATION
# ==========================================
auth.service.url=lb://authentication-service
auth.service.validate-endpoint=/api/v1/auth/validate

# Authentication Hook (set to false to bypass auth during development)
auth.enabled=true

# Mock user data when auth.enabled=false
auth.mock.user-id=dev-user-001
auth.mock.username=dev@example.com
auth.mock.roles=USER,ADMIN

# ==========================================
# CORS CONFIGURATION
# ==========================================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].max-age=3600

# ==========================================
# CIRCUIT BREAKER INSTANCES (Gateway-Specific)
# ==========================================
# Default config inherited from application.properties
resilience4j.circuitbreaker.instances.authCircuitBreaker.base-config=default
resilience4j.circuitbreaker.instances.bookCircuitBreaker.base-config=default
resilience4j.circuitbreaker.instances.inventoryCircuitBreaker.base-config=default
resilience4j.circuitbreaker.instances.orderCircuitBreaker.base-config=default
resilience4j.circuitbreaker.instances.reviewCircuitBreaker.base-config=default
resilience4j.circuitbreaker.instances.userCircuitBreaker.base-config=default

# ==========================================
# RATE LIMITER INSTANCES (Gateway-Specific)
# ==========================================
# Default config inherited from application.properties
resilience4j.ratelimiter.instances.authRateLimiter.limit-for-period=50
resilience4j.ratelimiter.instances.authRateLimiter.limit-refresh-period=1s

# ==========================================
# GATEWAY-SPECIFIC LOGGING OVERRIDES
# ==========================================
logging.level.com.book.management.api_gateway=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty=INFO
logging.file.name=logs/api-gateway.log

# ==========================================
# GATEWAY-SPECIFIC ACTUATOR ENDPOINTS
# ==========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,gateway,env,routes,filters
management.endpoint.gateway.enabled=true
management.metrics.enable.gateway=true

# Info endpoint (Gateway-specific)
info.app.name=API Gateway
info.app.description=Common API Gateway for Digital Bookstore Microservices
info.app.version=1.0.0
info.app.services=book-service,inventory-service,order-service,review-service,user-service,authentication-service

# ==========================================
# SECURITY HEADERS (Gateway-Specific)
# ==========================================
gateway.security.headers.enabled=true
gateway.security.headers.x-content-type-options=nosniff
gateway.security.headers.x-frame-options=DENY
gateway.security.headers.x-xss-protection=1; mode=block
gateway.security.headers.strict-transport-security=max-age=31536000

# ==========================================
# CUSTOM GATEWAY PROPERTIES
# ==========================================
gateway.timeout.connect=3000
gateway.timeout.read=5000
gateway.timeout.write=5000
gateway.retry.max-attempts=3
gateway.retry.backoff-multiplier=2
gateway.loadbalancer.enabled=true
gateway.loadbalancer.use-raw-status-code-in-response-data=true

# ==========================================
# WEBCLIENT CONFIGURATION (Gateway-Specific)
# ==========================================
spring.webflux.base-path=/
webclient.connection-timeout=3000
webclient.read-timeout=5000
webclient.write-timeout=5000
webclient.max-in-memory-size=10MB

# ==========================================
# MONITORING & TRACING (Gateway-Specific)
# ==========================================
spring.cloud.gateway.metrics.enabled=true
gateway.request-id.header=X-Request-ID
gateway.request-id.generate=true