# ==========================================
# EUREKA SERVER CONFIGURATION
# ==========================================
spring.application.name=eureka-server
server.port=8761
spring.banner.location=classpath:banner.txt
# ==========================================
# EUREKA SERVER SETTINGS
# ==========================================
# This is the Eureka Server itself, so don't register as a client
eureka.client.register-with-eureka=false
eureka.client.fetch-registry=false

# Eureka server URL (for clients to connect)
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# ==========================================
# EUREKA SERVER INSTANCE CONFIGURATION
# ==========================================
# Hostname for this Eureka instance
eureka.instance.hostname=localhost

# Prefer IP address over hostname for clients
eureka.instance.prefer-ip-address=false

# Status page and health check URLs
eureka.instance.status-page-url-path=/actuator/info
eureka.instance.health-check-url-path=/actuator/health

# ==========================================
# SELF PRESERVATION MODE
# ==========================================
# Enable self-preservation mode (protects registry during network issues)
# In production: true
# In development: false (for easier testing)
eureka.server.enable-self-preservation=true

# Threshold for self-preservation (default 0.85 = 85%)
# If less than 85% of services send heartbeats, self-preservation activates
eureka.server.renewal-percent-threshold=0.85

# Time to wait after startup before self-preservation can activate (in ms)
eureka.server.wait-time-in-ms-when-sync-empty=5

# Expected heartbeats per minute per instance (default 2)
eureka.server.expected-client-renewal-interval-seconds=30

# ==========================================
# EVICTION AND RENEWAL
# ==========================================
# How often to check for expired clients (default 60s)
eureka.server.eviction-interval-timer-in-ms=60000

# Client lease expiration (if no heartbeat received in 90s)
eureka.instance.lease-expiration-duration-in-seconds=90

# How often clients send heartbeat (default 30s)
eureka.instance.lease-renewal-interval-in-seconds=30

# ==========================================
# RESPONSE CACHE
# ==========================================
# Response cache update interval (default 30s)
eureka.server.response-cache-update-interval-ms=30000

# Response cache auto expiration in seconds
eureka.server.response-cache-auto-expiration-in-seconds=180

# Use read-only response cache
eureka.server.use-read-only-response-cache=true

# ==========================================
# REGISTRY SYNC
# ==========================================
# Retry count for registry sync with peers
eureka.server.registry-sync-retries=3

# Retry wait time for registry sync
eureka.server.registry-sync-retry-wait-ms=1000

# Max threads for peer replication
eureka.server.max-threads-for-peer-replication=20

# ==========================================
# DELTA UPDATES
# ==========================================
# Disable delta updates (always fetch full registry)
# false = enable delta (more efficient), true = disable delta
eureka.server.disable-delta=false

# Delta retention time
eureka.server.delta-retention-timer-interval-in-ms=30000

# ==========================================
# RATE LIMITER
# ==========================================
# Enable rate limiter for registry requests
eureka.server.rate-limiter-enabled=true

# Rate limiter burst size
eureka.server.rate-limiter-burst-size=10

# Rate limiter registry fetch average rate
eureka.server.rate-limiter-registry-fetch-average-rate=500

# Rate limiter full fetch average rate
eureka.server.rate-limiter-full-fetch-average-rate=100

# ==========================================
# PEER AWARENESS (High Availability)
# ==========================================
# For HA setup with multiple Eureka servers
# Uncomment and configure for production

# eureka.client.register-with-eureka=true
# eureka.client.fetch-registry=true
# eureka.client.service-url.defaultZone=http://eureka-peer1:8761/eureka/,http://eureka-peer2:8762/eureka/

# ==========================================
# LOGGING CONFIGURATION
# ==========================================
logging.level.root=INFO
logging.level.com.netflix.eureka=INFO
logging.level.com.netflix.discovery=INFO
logging.level.org.springframework.cloud.netflix.eureka=DEBUG
logging.level.org.springframework.web=INFO

# Logging Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [${spring.application.name}] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [${spring.application.name}] %-5level %logger{36} - %msg%n

# Log File Configuration
logging.file.name=logs/eureka-server.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=100MB

# ==========================================
# ACTUATOR CONFIGURATION
# ==========================================
management.endpoints.web.exposure.include=health,info,metrics,env,loggers
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always

# Info endpoint
info.app.name=Eureka Service Registry
info.app.description=Service Discovery and Registration Server for Digital Bookstore
info.app.version=1.0.0
info.app.encoding=${project.build.sourceEncoding}
info.app.java.version=${java.version}

# ==========================================
# UI CONFIGURATION
# ==========================================
# Enable Eureka dashboard
eureka.dashboard.enabled=true

# Path for Eureka dashboard (default /)
eureka.dashboard.path=/

# ==========================================
# SECURITY CONFIGURATION (Production)
# ==========================================
# Uncomment below for basic authentication in production

# spring.security.user.name=admin
# spring.security.user.password=change_this_in_production

# For clients to authenticate with secured Eureka:
# eureka.client.service-url.defaultZone=http://admin:password@localhost:8761/eureka/

# ==========================================
# SERVER CONFIGURATION
# ==========================================
# Connection timeout
server.connection-timeout=20000

# Max HTTP header size
server.max-http-header-size=8192

# Compression
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# ==========================================
# JSON CONFIGURATION
# ==========================================
spring.jackson.serialization.indent-output=true
spring.jackson.default-property-inclusion=non_null

# ==========================================
# ENVIRONMENT-SPECIFIC PROFILES
# ==========================================
# spring.profiles.active=dev

# Development profile: disable self-preservation for easier testing
# Production profile: enable self-preservation, security, HA setup
