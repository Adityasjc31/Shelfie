# ==========================================
# APPLICATION CONFIGURATION
# ==========================================
spring.application.name=inventory-service
server.port=9081

# ==========================================
# CONFIG SERVER CONFIGURATION
# ==========================================
spring.config.import=optional:configserver:http://localhost:8888
spring.cloud.config.enabled=true
spring.cloud.config.fail-fast=false
spring.cloud.config.retry.max-attempts=3
spring.cloud.config.retry.initial-interval=1000

# ==========================================
# EUREKA CLIENT CONFIGURATION
# ==========================================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# Instance metadata for health checks
eureka.instance.metadata-map.version=1.0
eureka.instance.metadata-map.service-type=inventory
eureka.instance.health-check-url-path=/actuator/health

# ==========================================
# DATABASE CONFIGURATION - MySQL
# ==========================================
spring.datasource.url=jdbc:mysql://localhost:3306/bookstore_inventory?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.open-in-view=false

# Enable JPA auditing
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

# Connection Pool Configuration (HikariCP)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=InventoryHikariPool

# ==========================================
# LOGGING CONFIGURATION
# ==========================================
logging.level.root=INFO
logging.level.com.book.management=DEBUG
logging.level.com.book.management.inventory=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.cloud=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Logging Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [${spring.application.name}] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [${spring.application.name}] %-5level %logger{36} - %msg%n

# Log File Configuration
logging.file.name=logs/inventory-service.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=100MB

# ==========================================
# ACTUATOR CONFIGURATION
# ==========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,beans,mappings
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# Health check
management.health.db.enabled=true
management.health.diskspace.enabled=true

# Info endpoint
info.app.name=Inventory Service
info.app.description=Digital Bookstore Inventory Management Service
info.app.version=1.0.0
info.app.encoding=${project.build.sourceEncoding}
info.app.java.version=${java.version}

# ==========================================
# API GATEWAY INTEGRATION
# ==========================================
# Routes are configured in API Gateway
# This service will be accessed via: http://gateway:8080/inventory/**

# ==========================================
# RESILIENCE4J - Circuit Breaker Configuration
# ==========================================
resilience4j.circuitbreaker.instances.inventoryService.register-health-indicator=true
resilience4j.circuitbreaker.instances.inventoryService.sliding-window-size=10
resilience4j.circuitbreaker.instances.inventoryService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.inventoryService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.inventoryService.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.inventoryService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.inventoryService.slow-call-duration-threshold=2s
resilience4j.circuitbreaker.instances.inventoryService.slow-call-rate-threshold=50

# ==========================================
# RESILIENCE4J - Retry Configuration
# ==========================================
resilience4j.retry.instances.inventoryService.max-attempts=3
resilience4j.retry.instances.inventoryService.wait-duration=1s
resilience4j.retry.instances.inventoryService.enable-exponential-backoff=true
resilience4j.retry.instances.inventoryService.exponential-backoff-multiplier=2

# ==========================================
# RESILIENCE4J - Rate Limiter Configuration
# ==========================================
resilience4j.ratelimiter.instances.inventoryService.limit-for-period=100
resilience4j.ratelimiter.instances.inventoryService.limit-refresh-period=1s
resilience4j.ratelimiter.instances.inventoryService.timeout-duration=0s

# ==========================================
# SWAGGER/OPENAPI DOCUMENTATION
# ==========================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.packages-to-scan=com.book.management.inventory.controller

# API Info
springdoc.api-docs.groups.enabled=true
springdoc.group-configs[0].group=inventory
springdoc.group-configs[0].paths-to-match=/api/v1/inventory/**

# ==========================================
# JACKSON CONFIGURATION
# ==========================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null

# ==========================================
# SECURITY CONFIGURATION
# ==========================================
# Security is handled by API Gateway and Authentication Service
# This service trusts authenticated requests from the gateway

# ==========================================
# TRANSACTION CONFIGURATION
# ==========================================
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true

# ==========================================
# MULTIPART FILE UPLOAD (if needed in future)
# ==========================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ==========================================
# CUSTOM APPLICATION PROPERTIES
# ==========================================
# Inventory specific configurations
inventory.low-stock.default-threshold=10
inventory.low-stock.alert-enabled=true
inventory.bulk-operations.max-batch-size=100

# ==========================================
# FEIGN CLIENT CONFIGURATION (for inter-service communication)
# ==========================================
feign.client.config.default.connect-timeout=5000
feign.client.config.default.read-timeout=5000
feign.client.config.default.logger-level=full

# ==========================================
# DEVELOPMENT/PRODUCTION PROFILES
# ==========================================
# Use spring.profiles.active to switch between environments
# Development: spring.profiles.active=dev
# Production: spring.profiles.active=prod